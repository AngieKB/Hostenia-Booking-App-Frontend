<!-- Mostrar header según estado de login -->
@if (isLogged) {
<app-main-header [currentPage]="'principal'"></app-main-header>
} @else {
<app-empty-header></app-empty-header>
}

<!-- Hero Section con título -->
<div class="hero-section">
  <div class="container">
    <h1 class="hero-title">ALOJAMIENTOS</h1>
  </div>
</div>

<!-- Sección de búsqueda (solo visible si está logueado) -->
@if (isLogged) {
<div class="search-section">
  <div class="container">
    <div class="search-card">
      <h3 class="mb-4">Buscar Alojamientos</h3>
      <div class="row g-3">
        <!-- Ciudad -->
        <div class="col-lg-2 col-md-6">
          <label class="form-label">Ciudad</label>
          <input
            type="text"
            class="form-control"
            placeholder="¿Cual ciudad prefieres?"
            [(ngModel)]="filtros.ciudad"
          />
        </div>

        <!-- Rango de fechas -->
        <div class="col-lg-4 col-md-6">
          <label class="form-label">Rango de fechas</label>
          <div class="row g-2">
            <div class="col-6">
              <input
                type="date"
                class="form-control"
                placeholder="Desde"
                [(ngModel)]="filtros.fechaInicio"
                [min]="fechaMinima"
              />
            </div>
            <div class="col-6">
              <input
                type="date"
                class="form-control"
                placeholder="Hasta"
                [(ngModel)]="filtros.fechaFin"
                [min]="filtros.fechaInicio || fechaMinima"
              />
            </div>
          </div>
        </div>

        <!-- Precio -->
        <div class="col-lg-3 col-md-6">
          <label class="form-label">Rango de precio</label>
          <div class="mb-2">
            <small class="text-muted"
              >{{ formatearPrecio(filtros.precio.min) }} -
              {{ formatearPrecio(filtros.precio.max) }}</small
            >
          </div>
          <div class="mb-2">
            <label class="form-label small">Mínimo</label>
            <input
              type="range"
              class="form-range"
              min="0"
              max="1000000"
              step="50000"
              [(ngModel)]="filtros.precio.min"
              (input)="ajustarPrecioMinimo()"
            />
          </div>
          <div>
            <label class="form-label small">Máximo</label>
            <input
              type="range"
              class="form-range"
              min="0"
              max="1000000"
              step="50000"
              [(ngModel)]="filtros.precio.max"
              (input)="ajustarPrecioMaximo()"
            />
          </div>
        </div>

        <!-- Servicios -->
        <div class="col-lg-2 col-md-4">
          <label class="form-label">Servicios</label>
          <div class="dropdown">
            <button
              class="btn btn-outline-secondary dropdown-toggle w-100"
              type="button"
              id="dropdownServicios"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Seleccionar
            </button>
            <ul class="dropdown-menu p-3" aria-labelledby="dropdownServicios">
              <li class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [(ngModel)]="filtros.servicios.wifi"
                  id="wifi"
                />
                <label class="form-check-label" for="wifi">WiFi</label>
              </li>
              <li class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [(ngModel)]="filtros.servicios.piscina"
                  id="piscina"
                />
                <label class="form-check-label" for="piscina">Piscina</label>
              </li>
              <li class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [(ngModel)]="filtros.servicios.cocina"
                  id="cocina"
                />
                <label class="form-check-label" for="cocina">Cocina</label>
              </li>
              <li class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [(ngModel)]="filtros.servicios.mascotas"
                  id="mascotas"
                />
                <label class="form-check-label" for="mascotas">Mascotas</label>
              </li>
            </ul>
          </div>
        </div>

        <!-- Botón de búsqueda -->
        <div class="col-lg-1 col-md-2 d-flex align-items-end">
          <button class="btn btn-search w-100" (click)="buscarAlojamientos()" title="Buscar">
            <i class="bi bi-search"></i>
          </button>
        </div>
      </div>
    </div>

    <div id="map"></div>
  </div>
</div>
}

<!-- Sección de alojamientos -->
<div class="alojamientos-section">
  <div class="container">
    <h2 class="section-title">Nuestros Alojamientos</h2>

    <div class="row">
      <div class="col-lg-4 col-md-6 mb-4" *ngFor="let alojamiento of alojamientosFiltrados">
        <div class="alojamiento-card">
          <!-- Imagen -->
          <div class="alojamiento-image">
            <img
              [src]="alojamiento.galeria[0] || 'assets/placeholder.jpg'"
              [alt]="alojamiento.titulo"
              class="w-100"
            />
            <!-- Botón favorito (solo si está logueado) -->
            <button
              *ngIf="isLogged"
              class="btn-favorito"
              [class.active]="esFavorito(alojamiento.id)"
              (click)="toggleFavorito(alojamiento.id)"
            >
              <i
                class="bi"
                [class.bi-heart]="!esFavorito(alojamiento.id)"
                [class.bi-heart-fill]="esFavorito(alojamiento.id)"
              ></i>
            </button>
            <!-- Badge de precio -->
            <div class="precio-badge">{{ formatearPrecio(alojamiento.precioNoche) }} COP</div>
          </div>

          <!-- Información -->
          <div class="alojamiento-info">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h5 class="alojamiento-titulo">{{ alojamiento.titulo }}</h5>
              <div class="calificacion">
                <i class="bi bi-star-fill"></i>
                <span>{{ calcularCalificacionPromedio(alojamiento) }}</span>
              </div>
            </div>

            <p class="text-muted small mb-3">
              <i class="bi bi-geo-alt"></i> {{ alojamiento.ubicacion.ciudad }}
            </p>

            <!-- Servicios -->
            <div class="servicios-icons mb-3">
              <span *ngIf="contarServicios(alojamiento, 'wifi')" title="WiFi">
                <i class="bi bi-wifi"></i>
              </span>
              <span *ngIf="contarServicios(alojamiento, 'piscina')" title="Piscina">
                <i class="fas fa-swimming-pool"></i>
              </span>
              <span *ngIf="contarServicios(alojamiento, 'cocina')" title="Cocina">
                <i class="fas fa-kitchen-set"></i>
              </span>
              <span *ngIf="contarServicios(alojamiento, 'mascotas')" title="Permite mascotas">
                <i class="fas fa-paw"></i>
              </span>
              <span *ngIf="alojamiento.capacidadMax" title="Capacidad">
                <i class="bi bi-people"></i> {{ alojamiento.capacidadMax }}
              </span>
            </div>

            <!-- Botón ver más -->
            <button class="btn btn-outline-success w-100" (click)="verDetalles(alojamiento.id)">
              Ver detalles
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Mensaje si no hay resultados -->
    <div *ngIf="alojamientosFiltrados.length === 0" class="text-center py-5">
      <i class="bi bi-house-slash" style="font-size: 4rem; color: #ccc"></i>
      <p class="text-muted mt-3">No se encontraron alojamientos con los filtros seleccionados</p>
    </div>
  </div>
</div>

<app-footer></app-footer>
