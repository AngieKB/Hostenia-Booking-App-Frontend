<app-empty-header></app-empty-header>

<!-- Contenido principal -->
<div class="container-fluid py-5" style="background-color: #E8F5E9; min-height: calc(100vh - 200px);">
  <div class="row justify-content-center">
    <!-- Sección de Registro -->
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Registrarse</h5>
        </div>
        <div class="card-body">
          <!-- Mensaje de error -->
          <div *ngIf="mensajeErrorRegistro" class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ mensajeErrorRegistro }}
            <button type="button" class="btn-close" (click)="mensajeErrorRegistro = ''"></button>
          </div>

          <form (ngSubmit)="registrar()">
            <!-- Nombre -->
            <div class="mb-3">
              <label class="form-label">Nombre</label>
              <input 
                type="text" 
                class="form-control" 
                placeholder="Ingrese su nombre"
                [(ngModel)]="registroData.nombre"
                name="nombre"
                required>
            </div>

            <!-- Correo electrónico -->
            <div class="mb-3">
              <label class="form-label">Correo electrónico</label>
              <input 
                type="email" 
                class="form-control" 
                placeholder="Ingrese su correo electrónico"
                [(ngModel)]="registroData.email"
                name="email"
                required>
            </div>

            <!-- Selección de rol -->
            <div class="mb-3">
              <label class="form-label">Elija el rol con el que desea registrarte</label>
              <div class="d-flex gap-2">
                <button 
                  type="button" 
                  class="btn flex-fill"
                  [class.btn-success]="registroData.rol === 'Usuario'"
                  [class.btn-outline-secondary]="registroData.rol !== 'Usuario'"
                  (click)="seleccionarRol('Usuario')">
                  Usuario
                </button>
                <button 
                  type="button" 
                  class="btn flex-fill"
                  [class.btn-success]="registroData.rol === 'Anfitrion'"
                  [class.btn-outline-secondary]="registroData.rol !== 'Anfitrion'"
                  (click)="seleccionarRol('Anfitrion')">
                  Anfitrión
                </button>
              </div>
            </div>

            <!-- Contraseña -->
            <div class="mb-3">
              <label class="form-label">Contraseña</label>
              <input 
                type="password" 
                class="form-control" 
                placeholder="Ingrese la contraseña que desea"
                [(ngModel)]="registroData.password"
                name="password"
                required>
            </div>

            <!-- Teléfono -->
            <div class="mb-3">
              <label class="form-label">Teléfono</label>
              <input 
                type="tel" 
                class="form-control" 
                placeholder="Ingrese su número de teléfono"
                [(ngModel)]="registroData.telefono"
                name="telefono"
                required>
            </div>

            <!-- Fecha de nacimiento -->
            <div class="mb-3">
              <label class="form-label">Fecha de nacimiento</label>
              <input 
                type="date" 
                class="form-control" 
                placeholder="Selecciona una fecha"
                [(ngModel)]="registroData.fechaNacimiento"
                name="fechaNacimiento"
                required>
            </div>

            <!-- Foto de perfil -->
            <div class="mb-3">
              <label class="form-label">Foto de perfil (opcional)</label>
              <input 
                type="file" 
                class="form-control" 
                accept="image/*"
                (change)="onFileSelected($event)"
                name="fotoUrl">
              <small class="text-muted">Formatos aceptados: JPG, PNG, GIF</small>
            </div>

            <!-- Botón de registro -->
            <button 
              type="submit" 
              class="btn btn-success w-100"
              [disabled]="registrando">
              <span *ngIf="registrando" class="spinner-border spinner-border-sm me-2"></span>
              {{ registrando ? 'Registrando...' : 'Ingresar' }}
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Sección de Iniciar Sesión -->
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Iniciar Sesión</h5>
        </div>
        <div class="card-body">
          <!-- Mensaje de error -->
          <div *ngIf="mensajeErrorLogin" class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ mensajeErrorLogin }}
            <button type="button" class="btn-close" (click)="mensajeErrorLogin = ''"></button>
          </div>

          <form (ngSubmit)="iniciarSesion()">
            <!-- Correo electrónico -->
            <div class="mb-3">
              <label class="form-label">Correo electrónico</label>
              <input 
                type="email" 
                class="form-control" 
                placeholder="Ingrese su correo electrónico"
                [(ngModel)]="loginData.email"
                name="loginEmail"
                required>
            </div>

            <!-- Contraseña -->
            <div class="mb-3">
              <label class="form-label">Contraseña</label>
              <input 
                type="password" 
                class="form-control" 
                placeholder="Ingrese su contraseña"
                [(ngModel)]="loginData.password"
                name="loginPassword"
                required>
            </div>

            <!-- Enlace olvidaste tu contraseña -->
            <div class="mb-3 text-center">
              <a href="javascript:void(0)" class="text-success" (click)="abrirModalRecuperar()">
                ¿Olvidaste tu contraseña?
              </a>
            </div>

            <!-- Botón de ingreso -->
            <button 
              type="submit" 
              class="btn btn-success w-100"
              [disabled]="iniciandoSesion">
              <span *ngIf="iniciandoSesion" class="spinner-border spinner-border-sm me-2"></span>
              {{ iniciandoSesion ? 'Iniciando sesión...' : 'Ingresar' }}
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Recuperar Contraseña -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title">Recuperar contraseña</h5>
        <button type="button" class="btn-close" (click)="cerrarModal()"></button>
      </div>
      <div class="modal-body">
        <!-- Mensajes de error y éxito -->
        <div *ngIf="mensajeError" class="alert alert-danger alert-dismissible fade show" role="alert">
          {{ mensajeError }}
          <button type="button" class="btn-close" (click)="mensajeError = ''"></button>
        </div>
        <div *ngIf="mensajeExito" class="alert alert-success alert-dismissible fade show" role="alert">
          {{ mensajeExito }}
          <button type="button" class="btn-close" (click)="mensajeExito = ''"></button>
        </div>

        <!-- Paso 1: Ingresar email y solicitar código -->
        <div *ngIf="!codigoEnviado">
          <p class="text-muted small">Ingrese su correo electrónico para recibir un código de verificación</p>
          
          <div class="mb-3">
            <label class="form-label">Correo electrónico</label>
            <input 
              type="email" 
              class="form-control" 
              placeholder="correo@ejemplo.com"
              [(ngModel)]="recuperarData.email"
              name="email"
              required>
          </div>

          <button 
            type="button" 
            class="btn btn-primary w-100" 
            (click)="enviarCodigo()"
            [disabled]="enviandoCodigo">
            <span *ngIf="enviandoCodigo" class="spinner-border spinner-border-sm me-2"></span>
            {{ enviandoCodigo ? 'Enviando...' : 'Enviar código' }}
          </button>
        </div>

        <!-- Paso 2: Ingresar código y nueva contraseña -->
        <form *ngIf="codigoEnviado" (ngSubmit)="establecerPassword()">
          <p class="text-muted small">Se ha enviado un código de verificación a {{ recuperarData.email }}</p>
          
          <!-- Código -->
          <div class="mb-3">
            <label class="form-label">Código de verificación</label>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Código"
              [(ngModel)]="recuperarData.codigo"
              name="codigo"
              required>
            <small class="text-muted">El código se vence en 15min</small>
          </div>

          <!-- Botón reenviar código -->
          <div class="mb-3">
            <button 
              type="button" 
              class="btn btn-info w-100" 
              (click)="reenviarCodigo()"
              [disabled]="enviandoCodigo">
              <span *ngIf="enviandoCodigo" class="spinner-border spinner-border-sm me-2"></span>
              {{ enviandoCodigo ? 'Reenviando...' : 'Reenviar código' }}
            </button>
          </div>

          <!-- Nueva contraseña -->
          <div class="mb-3">
            <label class="form-label">Nueva contraseña</label>
            <input 
              type="password" 
              class="form-control" 
              placeholder="Nueva contraseña"
              [(ngModel)]="recuperarData.nuevaPassword"
              name="nuevaPassword"
              required>
            <small class="text-muted">Mínimo 8 caracteres, incluir mayúscula, minúscula y número</small>
          </div>

          <!-- Botón establecer contraseña -->
          <button 
            type="submit" 
            class="btn btn-success w-100"
            [disabled]="enviandoPassword">
            <span *ngIf="enviandoPassword" class="spinner-border spinner-border-sm me-2"></span>
            {{ enviandoPassword ? 'Estableciendo...' : 'Establecer contraseña' }}
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop del modal -->
<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal" (click)="cerrarModal()"></div>

<app-footer></app-footer>