<app-main-header></app-main-header>

<div class="detalles-container" *ngIf="alojamiento">
  <h1 class="page-title">Detalles del Alojamiento</h1>

  <!-- Galería de Imágenes -->
  <div class="galeria-section">
    <div class="imagen-principal">
      <img [src]="imagenPrincipal" [alt]="alojamiento.titulo">
      <div class="host-badge">
        <div class="host-info">
          <span class="host-label">Alojado por:</span>
          <span class="host-name">{{ nombreAnfitrion }}</span>
        </div>
      </div>
    </div>
    <div class="imagenes-thumbnails">
      <div 
        class="thumbnail" 
        *ngFor="let imagen of alojamiento.galeria.slice(0, 4)"
        (click)="seleccionarImagen(imagen)">
        <img [src]="imagen" alt="Thumbnail">
      </div>
    </div>
  </div>

  <!-- Información Principal -->
  <div class="info-section">
    <div class="info-left">
      <div class="titulo-acciones">
        <div>
          <h2 class="alojamiento-titulo">{{ alojamiento.titulo }}</h2>
          <p class="ubicacion">{{ alojamiento.ubicacion.ciudad }}</p>
        </div>
        <div class="acciones-icons">
          <button class="icon-btn" (click)="toggleFavorito()">
            <span class="material-icons">favorite_border</span>
          </button>
          <button class="icon-btn" (click)="compartir()">
            <span class="material-icons">share</span>
          </button>
        </div>
      </div>

      <!-- Servicios -->
      <div class="servicios-grid">
        <div class="servicio-item" *ngFor="let servicio of alojamiento.servicios">
          <i *ngIf="servicio.toLowerCase().includes('wifi')" class="bi bi-wifi servicio-icon"></i>
          <i *ngIf="servicio.toLowerCase().includes('cocina')" class="fas fa-kitchen-set servicio-icon"></i>
          <i *ngIf="servicio.toLowerCase().includes('piscina')" class="fas fa-swimming-pool servicio-icon"></i>
          <i *ngIf="servicio.toLowerCase().includes('mascotas')" class="fas fa-paw servicio-icon"></i>
          <span class="servicio-nombre">{{ servicio }}</span>
        </div>
      </div>

      <!-- Descripción -->
      <div class="descripcion-section">
        <h3>Descripción del Alojamiento</h3>
        <p>{{ alojamiento.descripcion }}</p>
      </div>
    </div>

    <!-- Card de Reserva -->
    <div class="reserva-card">
      <div class="precio-info">
        <span class="precio">{{ formatearPrecio(alojamiento.precioNoche) }}</span>
        <span class="precio-label">Precio por noche</span>
      </div>
      <div class="capacidad-info">
        <span class="capacidad-label">Capacidad Máxima: </span>
        <span class="capacidad-valor">{{ alojamiento.capacidadMax }} personas</span>
      </div>
      <button class="btn-reservar" (click)="reservarAhora()">
        Reservar Ahora
      </button>
    </div>
  </div>

  <!-- Calificaciones y Comentarios -->
  <div class="comentarios-section">
    <div class="comentarios-header">
      <h3>
        Calificaciones y comentarios
        <span class="rating-badge">
          <span class="material-icons">star</span>
          {{ calcularCalificacionPromedio() }}
        </span>
      </h3>
      <button class="btn-calificar" (click)="openCalificarModal()">
        Comentar y calificar
      </button>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="cargandoComentarios" class="text-center py-4">
      <div class="spinner-border text-success" role="status">
        <span class="visually-hidden">Cargando comentarios...</span>
      </div>
    </div>

    <!-- Lista de Comentarios -->
<div class="comentarios-grid" *ngIf="!cargandoComentarios">
  <div class="comentario-card" *ngFor="let comentario of comentariosPaginados">

    <!-- CABECERA DEL COMENTARIO -->
    <div class="comentario-header">
      <img 
        class="comentario-avatar"
        [src]="comentario.fotoHuesped || 'assets/img/avatar-default.png'"
        alt="Foto del huésped"
      >

      <div class="comentario-info">
        <div class="d-flex align-items-center gap-2">
          <span class="comentario-autor">{{ comentario.nombreHuesped }}</span>

          <div class="calificacion-comentario">
            <i class="bi bi-star-fill"></i>
            <span>{{ comentario.calificacion }}</span>
          </div>
        </div>
        <span class="comentario-fecha">
          {{ formatearFechaComentario(comentario.fecha) }}
        </span>
      </div>
    </div>

    <!-- TEXTO DEL COMENTARIO -->
    <p class="comentario-texto">{{ comentario.texto }}</p>

    <!-- RESPUESTA DEL ANFITRIÓN (si existe) -->
    <div class="respuesta-container" *ngIf="comentario.textoRespuesta">

      <div class="respuesta-header">
        <img 
          class="respuesta-avatar"
          [src]="comentario.fotoAnfitrion || 'assets/img/avatar-default.png'"
          alt="Foto del anfitrión"
        >
        <div>
          <span class="respuesta-autor">{{ comentario.nombreAnfitrion}}</span>
          <span class="respuesta-label">      Anfitrión</span>
        </div>
      </div>

      <p class="respuesta-texto">{{ comentario.textoRespuesta }}</p>
    </div>

  </div>

  <!-- Si no hay comentarios -->
  <div *ngIf="comentariosPaginados.length === 0" class="text-center py-4">
    <p class="text-muted">No hay comentarios aún. ¡Sé el primero en comentar!</p>
  </div>
</div>

    <!-- Paginación de Comentarios -->
    <div class="paginacion" *ngIf="totalPaginasComentarios > 1 && !cargandoComentarios">
      <button 
        class="pag-btn" 
        (click)="cambiarPaginaComentarios(paginaActualComentarios)"
        [disabled]="paginaActualComentarios === 0">
        <span class="material-icons">keyboard_arrow_left</span>
      </button>
      <span class="px-3">Página {{ paginaActualComentarios + 1 }} de {{ totalPaginasComentarios }}</span>
      <button 
        class="pag-btn" 
        (click)="cambiarPaginaComentarios(paginaActualComentarios + 2)"
        [disabled]="paginaActualComentarios === totalPaginasComentarios - 1">
        <span class="material-icons">keyboard_arrow_right</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal de Calificar -->
<app-calificar-modal
  *ngIf="showCalificarModal"
  (close)="closeCalificarModal()"
  (guardar)="onGuardarCalificacion($event)">
</app-calificar-modal>
<app-footer></app-footer>