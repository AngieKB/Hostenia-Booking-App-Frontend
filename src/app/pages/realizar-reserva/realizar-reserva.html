<div class="reserva-container" *ngIf="!cargando && alojamiento">
  <div class="reserva-card">
    <!-- Header -->
    <div class="reserva-header">
      <div class="header-top">
        <button class="btn-volver" (click)="volver()">
          <i class="bi bi-arrow-left"></i> Volver
        </button>
        <h2 class="reserva-titulo">Realizar Reserva</h2>
      </div>
      <div class="alojamiento-info">
        <h3>{{ alojamiento.titulo }}</h3>
        <p class="ubicacion">{{ alojamiento.ubicacion.ciudad }}, {{ alojamiento.ubicacion.direccion }}</p>
        <div class="precio-info">
          <span class="precio">{{ formatearPrecio(alojamiento.precioNoche) }}</span>
          <span class="precio-label">por noche</span>
        </div>
      </div>
    </div>

    <!-- Calendarios -->
    <div class="calendarios-container">
      <!-- Check-in Calendar -->
      <div class="calendario-wrapper">
        <label class="form-label">Fecha check-in</label>
        <input 
          type="text" 
          class="form-control" 
          [value]="reserva.fechaCheckIn"
          placeholder="MM/DD/YYYY"
          readonly>
        
        <div class="calendario">
          <!-- Controles del mes -->
          <div class="calendario-header">
            <button class="btn-nav" (click)="cambiarMes('checkIn', -1)">
              <i class="bi bi-chevron-left"></i>
            </button>
            <span class="mes-año">
              {{ getNombreMes(mesCheckIn) }}
            </span>
            <button class="btn-nav" (click)="cambiarMes('checkIn', 1)">
              <i class="bi bi-chevron-right"></i>
            </button>
            <button class="btn-nav" (click)="cambiarAnio('checkIn', -1)">
              <i class="bi bi-chevron-left"></i>
            </button>
            <span class="mes-año">{{ mesCheckIn.getFullYear() }}</span>
            <button class="btn-nav" (click)="cambiarAnio('checkIn', 1)">
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>

          <!-- Días de la semana -->
          <div class="dias-semana">
            <div *ngFor="let dia of diasSemana" class="dia-semana">{{ dia }}</div>
          </div>

          <!-- Días del mes -->
          <div class="dias-mes">
            <div 
              *ngFor="let semana of dividirEnSemanas(getDiasDelMes(mesCheckIn))"
              class="semana">
              <div 
                *ngFor="let dia of semana"
                class="dia"
                [class.vacio]="dia === null"
                [class.seleccionado]="dia && esDiaSeleccionado(dia, 'checkIn')"
                (click)="dia && seleccionarFecha(dia, 'checkIn')">
                {{ dia }}
              </div>
            </div>
          </div>

        </div>
        
        <!-- Hora Check-in -->
        <div class="hora-section">
          <label class="form-label">Hora de check-in</label>
          <input 
            type="time" 
            class="form-control" 
            [(ngModel)]="reserva.horaCheckIn"
            min="06:00"
            max="23:00">
        </div>
      </div>

      <!-- Check-out Calendar -->
      <div class="calendario-wrapper">
        <label class="form-label">Fecha check-out</label>
        <input 
          type="text" 
          class="form-control" 
          [value]="reserva.fechaCheckOut"
          placeholder="MM/DD/YYYY"
          readonly>
        
        <div class="calendario">
          <!-- Controles del mes -->
          <div class="calendario-header">
            <button class="btn-nav" (click)="cambiarMes('checkOut', -1)">
              <i class="bi bi-chevron-left"></i>
            </button>
            <span class="mes-año">
              {{ getNombreMes(mesCheckOut) }}
            </span>
            <button class="btn-nav" (click)="cambiarMes('checkOut', 1)">
              <i class="bi bi-chevron-right"></i>
            </button>
            <button class="btn-nav" (click)="cambiarAnio('checkOut', -1)">
              <i class="bi bi-chevron-left"></i>
            </button>
            <span class="mes-año">{{ mesCheckOut.getFullYear() }}</span>
            <button class="btn-nav" (click)="cambiarAnio('checkOut', 1)">
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>

          <!-- Días de la semana -->
          <div class="dias-semana">
            <div *ngFor="let dia of diasSemana" class="dia-semana">{{ dia }}</div>
          </div>

          <!-- Días del mes -->
          <div class="dias-mes">
            <div 
              *ngFor="let semana of dividirEnSemanas(getDiasDelMes(mesCheckOut))"
              class="semana">
              <div 
                *ngFor="let dia of semana"
                class="dia"
                [class.vacio]="dia === null"
                [class.seleccionado]="dia && esDiaSeleccionado(dia, 'checkOut')"
                (click)="dia && seleccionarFecha(dia, 'checkOut')">
                {{ dia }}
              </div>
            </div>
          </div>

        </div>
        
        <!-- Hora Check-out -->
        <div class="hora-section">
          <label class="form-label">Hora de check-out</label>
          <input 
            type="time" 
            class="form-control" 
            [(ngModel)]="reserva.horaCheckOut"
            min="06:00"
            max="18:00">
        </div>
      </div>
    </div>

    <!-- Número de huéspedes -->
    <div class="huespedes-section">
      <label class="form-label">Indique el número de huéspedes:</label>
      <input 
        type="number" 
        class="form-control" 
        [(ngModel)]="reserva.numeroHuespedes"
        min="1"
        placeholder="1">
    </div>

    <!-- Botón de reserva -->
    <button class="btn btn-reservar" (click)="realizarReserva()">
      Realizar Reserva
    </button>
  </div>
</div>

<!-- Estado de carga -->
<div *ngIf="cargando" class="loading-container">
  <div class="spinner"></div>
  <p>Cargando alojamiento...</p>
</div>
